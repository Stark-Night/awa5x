#!/bin/sh

cat <<EOF > ./test-eval-src
;; test printing
awa

awa awawa awawa awa awa awa awa awa awa awawa
awa awawa awawa awa awa awa awa awa awa awa awa
awa awa awa awawa
awa awa awa awawa
EOF
./awa5c ./test-eval-src > ./test-eval-cc
[ $? != 0 ] && echo 'compile test 1' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
out=`./awa5 test-eval-cc`
[ "x$out" != 'xAW' ] && echo 'run test 1' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
rm -f test-eval-src test-eval-cc

cat <<EOF > ./test-eval-src
;; test reading
awa

awa awa awawawa
awa awa awa awawa
EOF
./awa5c ./test-eval-src > ./test-eval-cc
[ $? != 0 ] && echo 'compile test 2' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
out=`echo 'AWA' | ./awa5 test-eval-cc`
[ "x$out" != 'xAWA' ] && echo 'run test 2' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
rm -f test-eval-src test-eval-cc

cat <<EOF > ./test-eval-src
;; test submerge
awa

awa awawa awawa awa awa awa awa awa awa awawa
awa awawa awawa awa awa awa awa awa awa awa awa
awa awawa awawa awa awa awa awa awa awa awawa
awa awawawa awa awa awa awa awa awa awa awa awa
awa awa awa awawa
EOF
./awa5c ./test-eval-src > ./test-eval-cc
[ $? != 0 ] && echo 'compile test 3' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
out=`./awa5 test-eval-cc`
[ "x$out" != 'xA' ] && echo 'run test 3' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
rm -f test-eval-src test-eval-cc

cat <<EOF > ./test-eval-src
;; test pop 1
awa

awa awawa awawa awa awa awa awa awa awa awawa
awa awawa awawa awa awa awa awa awa awa awa awa
awa awawawawa
awa awa awa awawa
EOF
./awa5c ./test-eval-src > ./test-eval-cc
[ $? != 0 ] && echo 'compile test 3' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
out=`./awa5 test-eval-cc`
[ "x$out" != 'xW' ] && echo 'run test 3' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
rm -f test-eval-src test-eval-cc

cat <<EOF > ./test-eval-src
;; test pop 2
awa

awa awawa awawa awa awa awa awa awa awa awa awa
awa awawa awawa awa awa awawa awa awa awa awa
awa awawa awawa awa awa awawa awa awa awa awa
awawa awawa awa
awa awawawawa
awa awa awa awawa
EOF
./awa5c ./test-eval-src > ./test-eval-cc
[ $? != 0 ] && echo 'compile test 4' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
out=`./awa5 test-eval-cc`
[ "x$out" != 'xl' ] && echo 'run test 4' 1>&2 && rm -f test-eval-src test-eval-cc && exit 1
rm -f test-eval-src test-eval-cc
