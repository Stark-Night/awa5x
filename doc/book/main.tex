%% awa5x - Extended AWA5.0
%% Copyright Â© 2024 Starknights

%% This program is free software: you can redistribute it and/or modify
%% it under the terms of the GNU General Public License as published by
%% the Free Software Foundation, either version 3 of the License, or
%% (at your option) any later version.

%% This program is distributed in the hope that it will be useful,
%% but WITHOUT ANY WARRANTY; without even the implied warranty of
%% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%% GNU General Public License for more details.

%% You should have received a copy of the GNU General Public License
%% along with this program.  If not, see <https://www.gnu.org/licenses/>.
\documentclass[11pt,a4paper,draft]{book}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[autostyle]{csquotes}
\usepackage{verbatim}
\usepackage{parskip}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{mathtools}
\usepackage[math-style=ISO,warnings-off={mathtools-color,mathtools-overbracket}]{unicode-math}
\usepackage{siunitx}
\usepackage{polyglossia}
\usepackage[colorlinks,hyperindex]{hyperref}
\setdefaultlanguage{english}

\DeclareSIUnit{\degreeFahrenheit}{\textdegree{}F}

\author{The Starcnight Initiatibe}
\title{The Extended AWA5 Programming Language}

\begin{document}
\frontmatter
\tableofcontents

\chapter{Preface}
(to be written.)

\mainmatter
\chapter{Introduction to Awatism}
An old adage says:
\textquote{The only way to learn a new programming language is by writing programs in it.};
thus, we'll begin our exploration of the language by presenting some
practical programs with the goal of letting you, the reader, reach the
point where you can write useful programs as quickly as possible.

To reach this goal, we will avoid getting lost in tedious details or
boring rules; rather, we will present the basics of correct programs
through working examples all the while providing only the necessary
informations to understand the given code.

On the other hand, omitting certain details and keeping the examples
simple can lead to misleading results: precaution ought to be taken
when issuing certain commands to the machine and possible techniques
to create good code might not be presented at all. The authors
encourage the reader to reach past what is shown in this chapter---or
even in this book as a whole---when starting a new project,
experiment, and find ways to improve.

\section{Greetings}
It is customary to send our regards to the world when learning a new
programming language; as such, we will now write a program which will
print these words:
\begin{verbatim}
Hello, world!
\end{verbatim}

It is assumed a basic writing environment is available to the reader,
such as being able to use a plain text editor, and that the tools
shown later are installed and available on the reader's machine.

In AWA5, the program to print \verb|Hello, world!| is:
\verbatiminput{hello1.awa}

That's an overwhelming listing of seemingly nonsensical words. For
now, let's try to get this program running: as a specific example
using the \emph{awa5x} suite of tools, create a file named
\verb|hello.awa|, then compile it as follows:
\begin{verbatim}
awa5c hello.awa > hello.wa
\end{verbatim}

If all went well, the compilation process will silently generate a
file called \verb|hello.wa|. This file is our \enquote{Hello world}
program and it can be run as follows:
\begin{verbatim}
awa5 hello.wa
\end{verbatim}

which will print:
\begin{verbatim}
Hello, world!
\end{verbatim}

Let's now examine the code. Every AWA5 program is written by composing
together two syllables:\,\emph{awa} and\,\emph{wa}; the first syllable
is to be written in isolation, following any amount of blanks, the
second one must immediately follow a syllable with no blanks
inbetween.

To better understand this rule, let's examine the second line of the
code listing:
\begin{verbatim*}
awa awawa awawa awa awawawa awawawawa
\end{verbatim*}

Each blank, indicated by the \verb*| | symbol,
separate each \emph{awa} syllable from the others;
the \emph{wa} syllable is instead connected to the
previous \emph{awa} or \emph{wa} syllable.

To be recognized as an AWA5 program, the code must begin with a single
\emph{awa} syllable. In our \enquote{Hello world} program it is the
very first line. A list of \emph{statements} follow this opening word,
each specifying an operation to be performed by the
machine. Statements are executed in order from top to bottom and the
program will terminate once the last command is reached.

Every AWA5 program operates on a hidden stack of \enquote{bubbles}
called \emph{abyss}: whenever something is \emph{pushed} inside the
abyss it will be considered the \emph{top} bubble; when programs
\emph{pop} from the abyss, this top bubble is removed. Pushing a
bubble will not make the previous one disappear; rather, it will be
stored \enquote{below} the top bubble until a pop command is
executed. The stored bubble will then become the new top.

Our \enquote{Hello world} program contains both a \emph{push} and a
\emph{pop} command, repeated multiple times in order to generate the
desired effect: the first few lines will push each letter of the
\verb|Hello, world!| sentence inside the abyss, then each value is
printed and automatically popped off.

It is important to highlighting that each character is inserted in
reversed order: the print command operates on the last inserted value,
thus to write our greetings correctly the \verb|H| letter must be
inserted last.

\textbf{Excercise 1-1}. Run the \enquote{Hello world} program. Try to
omit characters or lines and see what happens each time you compile
it. \\
\textbf{Excercise 1-2}. Change the order of each line after the first
(remember, \emph{awa} must be the very first word) and see the
result. Try adding more \emph{pop} command than \emph{push} ones and
try to answer why it doesn't work.

\section{Bits of information}
We have a working program and we know why it is written the way it is,
but we have yet to understand how it is able to understand each
statement.

Each statement is categorized as part of one of two groups: it can
either be a \emph{command} or a \emph{parameter}.

Commands are the instructions given to the machine. Our \enquote{Hello
  world} example featured two commands: one to push a value inside the
abyss, one to print the top value and pop it.

Parameters are values which commands operate on. Commands can take at
most one parameter, but not all commands accept a parameter; in our
example, the command to print the top value does not have one.

To understand how to recognize a command from a parameter, let's
return to the line we examined previously:
\begin{verbatim}
awa awawa awawa awa awawawa awawawawa
\end{verbatim}

We then substitute each \emph{awa} with a 0 (zero) and each \emph{wa}
with a 1 (one):
\begin{verbatim}
0010100110111
\end{verbatim}

This substitution gives us a representation of a \emph{binary number},
that is, a number composed only of the digits zero and one. Inside a
program, each digit of a binary number is called \emph{bit} and the
AWA5 language recognizes commands and parameters by examining which
bits are zero and which are one.

Commands are 5-bit values, which means five digits are examined from
left to right to understand which command needs to be executed by the
machine. In our example the command is \verb|00101|; converting it to
a decimal number---the system we normally use when counting---gives us
the number 5, which correspond to pushing the parameter in the abyss.

If a parameter is required by the command, eight more bits are
examined to understand the value of said parameter; in the line above
the parameter is \verb|00110111| corresponding to the number 55.

Converting each line in our \enquote{Hello world} example to
decimal numbers, we get the following:
\verbatiminput{hello2.awa}

Which number corresponds to which command, and whether or not it
accepts a parameter, is shown in more details in
Appendix~\ref{list-of-opcodes}.

\textbf{Excercise 1-3}. Try giving a parameter to the print command or
remove a parameter from a push command. You will get errors; why does
it happen? \\
\textbf{Excercise 1-4}. (This excercise is moderately advanced, if you
have little programming expertise you might want to skip it and return
back later.) Open the compiled program using an appropriate tool to
view binary files. Can you recognize the commands you wrote to print
\verb|Hello, world!|? Try to understand what the contents of the file
represent.

\section{Abyss Diving}
The next program converts a temperature expressed in Celsius degrees
into its Fahrenheit equivalent, using the formula \(F = \frac{9}{5}C + 32\).
We will try to convert \qty[mode=text]{100}{\degreeCelsius}, the
boiling point of water, into its Fahrenheit value:
\verbatiminput{celsius.awa}

Executing the program will tell us the result:
\qty[mode=text]{212}{\degreeFahrenheit}.

The code is not any more complicated than our \enquote{Hello world},
but introduces new commands and concepts.

Each line starting with a semicolon is a \emph{comment}, which in this
case explains what the commands below do. Anything between a semicolon
and the end of the line is ignored by the compiler, thus comments may
be used to type any kind of useful information without confusing the
machine.

The first two instructions are familiar: the program is pushing the
two values 100 and 9 inside the abyss.

\begin{verbatim}
awa awawa awawa awawawa awa awawa awa awa
awa awawa awawa awa awa awa awawa awa awawa
\end{verbatim}

On the third instruction we find the first new command introduced by
this program:

\begin{verbatim}
awawawa awawa
\end{verbatim}

This operation removes the first two bubbles from the
abyss and multiplies them, pushing the result inside the abyss; in
this example the top bubble will be the result of \(100 \times 9\),
which is 900.

The next few lines instruct the program to divide the top bubble by
5. However, the number 5 is not simply pushed into the abyss and then
the division is applied: a comment tells us the program is going to
\enquote{swap the two bubbles}.

\begin{verbatim}
awa awawa awawa awa awa awa awa awawa awawa
; swap the two bubbles
awa awawawa awa awa awa awa awa awa awa awawa
awawawawa awa
\end{verbatim}

This step is required because the top bubble is divided by the bubble
below; if 5 were to be the top bubble, the operation would've been \(5
\divslash 900\) instead of \(900 \divslash 5\), which is vastly
incorrect.

The attentive reader might have noticed that the program is
calculating \[\frac{9 \times 100}{5}\] instead of following the
conversion formula.

The AWA5 language operates only on \emph{integer} values which means
numbers with decimals, like \num{1.8} or \num{3.14159}, cannot be
stored inside the abyss; the number is \emph{truncated} by dropping
the fractional part---the digits after the point---instead.

In the conversion formula calculating \(\frac{9}{5}\) would normally
result in \num{1.8}, but due to truncation it will be just 1, giving
us \[1 \times 100 + 32 = 132\] which is incorrect.

Moving forward, the program adds 32 to the top bubble in the same
manner as the earlier multiplication, using the appropriate
command.

The next line is interesting:
\begin{verbatim}
; pop double bubble
awa awawawawa
\end{verbatim}

which is required because the division pushed inside the abyss a
\emph{double bubble}.

A single bubble pushed inside the abyss will contain the given value,
for example 100, 9 or 5; a double bubble instead comprises other
bubbles---single or double---and popping one will push each contained
bubble inside the abyss in the same order: the first bubble inside the
double bubble will become the top bubble of the abyss.

The bubble pushed by the division command is a double bubble whose
first item is the quotient, truncated, and the last item is the
remainder of the division.

Here the quotient is the converted temperature; because printing
operates only on the top bubble, the double bubble is split into its
contained bubbles to ensure the remainder does not interfere.

\textbf{Excercise 1-5}. Add a semicolon before the command to pop the
double bubble. Can you explain what is happening when you execute the
program? \\
\textbf{Excercise 1-6}. Take the \enquote{Hello world} program and add
a command to move the top bubble before printing. Change the parameter
and see what happens; what does a value of zero do? What if the
parameter is too big?

\section{Textual and Numeric Input}
So far our programs have worked on values we have specified directly
inside the code; however, programs often need to work on input
provided by users.

The AWA5 language recognizes two different kind of input and output:
textual and numeric. In our first example, \enquote{Hello world}, we
have seen textual ouput where the numbers pushed inside the abyss were
printed as letters; in the Celsius to Fahrenheit converter the output
was numeric, where the quotient was printed as a number.

Textual input and output operate within the bounds of the AWASCII
alphabet; any value not inside these bounds will be considered
invalid. The complete table of AWASCII characters can be found in
Appendix~\ref{list-of-awascii}.

Numeric input accepts any number that can be represented with 32 bits,
which means anything between \(-2^{31}\) and \(2^{31}-1\) or
\num{-2147483648} and \num{2147483647} in decimal notation. This
number must be written using valid AWASCII characters, thus negative
values will be prefixed with the \verb|~| symbol: \(-2\) is written as
\~{}2, for example.

\subsection{Textual input}
Let us extend our \enquote{Hello world} program to greet anyone the
user wishes for. We will first print the \verb|!| character to inform
the user we wish to obtain a line of AWASCII text, then we will
suspend the program execution until the user provides some valid
input.
\verbatiminput{hello3.awa}
% TBC with explanation

\subsection{Numerical input}
% TBC with Celsius example with user input

\appendix
\chapter{Reference Material}
\section{Introduction}
This appendix contains quick reference material: lists and tables with
essential information about certain topics.

Except for important notes in specific cases, there will not be any
detailed explanation; it is recommended to first read the preceding
chapters in case something is not clear.

\section{List of commands}
\label{list-of-opcodes}
\begin{longtable}{lll}
  \toprule
  Command & Awatism & Parameter \\
  \midrule \endhead

  \bottomrule \endfoot

  \textbf{NOP} & \verb|awa awa awa awa awa| & None \\
  \textbf{PRN} & \verb|awa awa awa awawa| & None \\
  \textbf{PR1} & \verb|awa awa awawa awa| & None \\
  \textbf{RED} & \verb|awa awa awawawa| & None \\
  \textbf{R3D} & \verb|awa awawa awa awa| & None \\
  \textbf{BLO} & \verb|awa awawa awawa| & Number \\
  \textbf{SBM} & \verb|awa awawawa awa| & Number \\
  \textbf{POP} & \verb|awa awawawawa| & None \\
  \textbf{DPL} & \verb|awawa awa awa awa| & None \\
  \textbf{SRN} & \verb|awawa awa awawa| & Number \\
  \textbf{MRG} & \verb|awawa awawa awa| & None \\
  \textbf{4DD} & \verb|awawa awawawa| & None \\
  \textbf{SUB} & \verb|awawawa awa awa| & None \\
  \textbf{MUL} & \verb|awawawa awawa| & None \\
  \textbf{DIV} & \verb|awawawawa awa| & None \\
  \textbf{CNT} & \verb|awawawawawa| & None \\
  \textbf{LBL} & \verb|~wa awa awa awa awa| & Number \\
  \textbf{JMP} & \verb|~wa awa awa awawa| & Numeric label \\
  \textbf{EQL} & \verb|~wa awa awawa awa| & None \\
  \textbf{LSS} & \verb|~wa awa awawawa| & None \\
  \textbf{GR8} & \verb|~wa awawa awa awa| & None \\
  \textbf{EQZ} & \verb|~wa awawa awawa| & None \\
  \textbf{TLB} & \verb|~wa awawawa awa| & AWASCII \\
  \textbf{JTL} & \verb|~wa awawawawa| & AWASCII label \\
  \textbf{CLL} & \verb|~wawa awa awa awa| & AWASCII label \\
  \textbf{RET} & \verb|~wawa awa awawa| & None \\
  \textbf{TRM} & \verb|~wawawawawa| & None \\
\end{longtable}

\begin{description}
\item[NOP] Does nothing and produces no effects.
\item[PRN] Print the top bubble as AWASCII and remove it from the abyss.
\item[PR1] Print the top bubble as a number and remove it from the abyss.
\item[RED] Request a line of AWASCII text from the user. The line will
  be stored as a double bubble comprising each character as a simple
  bubble.
\item[R3D] Request a number from the user and push it as a single
  bubble inside the abyss.
\item[BLO] Push the parameter inside the abyss.
\item[SMB] Push the top bubble down by a number of positions indicated
  by the parameter. A parameter of zero will push the bubble to the
  very bottom of the abyss.
\item[POP] Pop the top bubble off the abyss. If the bubble is double,
  each contained bubble will be pushed inside the abyss in the same
  order.
\item[DPL] Duplicate the top bubble and push it inside the
  abyss. Double bubbles will have their contents duplicated too.
\item[SRN] Create a double bubble containing the number of bubbles
  indicated by the parameter. These bubbles are moved inside the
  double bubble and not duplicated.
\item[MRG] Merge the first two bubbles into a double bubble. When at
  least one bubble is double, the contents are merged into a single
  double bubble.
\item[4DD] Sum the contents of the first two bubbles, pop them off the
  abyss and push a new bubble with the result inside the abyss. If one
  is a double bubble and the other a simple bubble, sum the value of
  the simple bubble to each item inside the double bubble; if both are
  double bubbles, sum each item until the smallest bubble runs out.
\item[SUB] Subtract the contents of the first two bubbles, pop them
  off the abyss and push a new bubble with the result inside the
  abyss. If one is a double bubble and the other a simple bubble,
  subtract the value of the simple bubble to each item inside the
  double bubble; if both are double bubbles, subtract each item until
  the smallest bubble runs out. The second bubble is subtracted from
  the top bubble.
\item[MUL] Multiply the contents of the first two bubbles, pop them
  off the abyss and push a new bubble with the result inside the
  abyss. If one is a double bubble and the other a simple bubble,
  multiply the value of the simple bubble to each item inside the
  double bubble; if both are double bubbles, multiply each item until
  the smallest bubble runs out.
\item[DIV] Divide the contents of the first two bubbles, pop them off
  the abyss and push a new bubble with the result inside the abyss. If
  one is a double bubble and the other a simple bubble, divide the
  value of the simple bubble to each item inside the double bubble; if
  both are double bubbles, divide each item until the smallest bubble
  runs out. The result is a double bubble whose first bubble is the
  quotient and the second bubble is the remainder.
\item[CNT] Push a new bubble inside the abyss with the size, in number
  of items, of the top bubble. A simple bubble has a size of zero.
\item[LBL] Register the current address at the given parameter.
\item[JMP] Move the internal instruction pointer to the address
  registered under the given parameter. Command execution will then
  resume at said address.
\item[EQL] Compare the first two bubbles: if the they have equal
  contents the next command is executed, otherwise it will be
  skipped. Single bubbles are compared directly, double bubbles will
  have each item compared.
\item[LSS] Compare the first two bubbles: if the top bubble is less
  than the bubble below the next command is executed, otherwise it
  will be skipped. Single bubbles are compared directly, double
  bubbles will have each item compared.
\item[GR8] Compare the first two bubbles: if the top bubble is greater
  than the bubble below the next command is executed, otherwise it
  will be skipped. Single bubbles are compared directly, double
  bubbles will have each item compared.
\item[EQZ] Skip the next command if the top bubble is either a double
  bubble or its value is not zero.
\item[TLB] Register the current address at the given parameter.
\item[JTL] Move the internal instruction pointer to the address
  registered under the given parameter. Command execution will then
  resume at said address.
\item[CLL] Save the current address and move the internal instruction
  pointer to the address registered under the given parameter. Command
  execution will then resume at said address. Each saved address will
  exist until the program resumes execution from one of them with the
  appropriate command.
\item[RET] Move the internal instruction pointer to the last saved
  address. Command execution will then resume at said address. The
  saved address is forgotten after execution is resumed.
\item[TRM] Terminate program execution, irrespective of any command
  that follows.
\end{description}

\section{AWASCII table}
\label{list-of-awascii}
\begin{tabular}{@{}ccclccclccc@{}}
  \toprule
  Dec. & Hex. & Value && Dec. & Hex. & Value && Dec. & Hex. & Value \\
  \midrule
  0 & 00 & A && 22 & 16 & u && 44 & 2C & 2 \\
  1 & 01 & W && 23 & 17 & m && 45 & 2D & 3 \\
  2 & 02 & a && 24 & 18 & P && 46 & 2E & 4 \\
  3 & 03 & w && 25 & 19 & C && 47 & 2F & 5 \\
  4 & 04 & J && 26 & 1A & N && 48 & 30 & 6 \\
  5 & 05 & E && 27 & 1B & T && 49 & 31 & 7 \\
  6 & 06 & L && 28 & 1C & p && 50 & 32 & 8 \\
  7 & 07 & Y && 29 & 1D & c && 51 & 33 & 9 \\
  8 & 08 & H && 30 & 1E & n && 52 & 34 & Blank\textsuperscript{\dag} \\
  9 & 09 & O && 31 & 1F & t && 53 & 35 & \verb|.| \\
  10 & 0A & S && 32 & 20 & B && 54 & 36 & \verb|,| \\
  11 & 0B & I && 33 & 21 & D && 55 & 37 & \verb|!| \\
  12 & 0C & U && 34 & 22 & F && 56 & 38 & \verb|'| \\
  13 & 0D & M && 35 & 23 & G && 57 & 39 & \verb|(| \\
  14 & 0E & j && 36 & 24 & R && 58 & 3A & \verb|)| \\
  15 & 0F & e && 37 & 25 & b && 59 & 3B & \verb|~| \\
  16 & 10 & l && 38 & 26 & d && 60 & 3C & \verb|_| \\
  17 & 11 & y && 39 & 27 & f && 61 & 3D & \verb|/| \\
  18 & 12 & h && 40 & 28 & g && 62 & 3E & \verb|;| \\
  19 & 13 & o && 41 & 29 & r && 63 & 3F & End of line\textsuperscript{\ddag} \\
  20 & 14 & s && 42 & 2A & 0 &&&& \\
  21 & 15 & i && 43 & 2B & 1 &&&& \\
  \bottomrule
\end{tabular}

\textsuperscript{\dag}\enquote{Dec.} is the value representation as a decimal (base~10)
number; \enquote{Hex.} is the value as a hexadecimal (base~16) number.

\textsuperscript{\ddag}\enquote{Blank} indicates a visible space; \enquote{End of line} will
terminate the current line and will move the cursor to the beginning
of the next. The end of a line is represented by a sequence of
characters which can change according to the underlying system.
\end{document}
